# Release 1.7.0 - IPFS Client Installation & Management

**Release Date:** November 21, 2025
**Type:** Minor Feature Release

## Overview

LSH v1.7.0 adds comprehensive IPFS client installation and management capabilities, making it even easier to work with IPFS-based local storage. The system now automatically detects, installs, and configures IPFS (Kubo) without requiring manual setup or root privileges.

## New Features

### 1. Automatic IPFS Client Installation

**What's New:**
- One-command IPFS client installation across all platforms
- Auto-detection of existing IPFS installations (system-wide or LSH-managed)
- Downloads official Kubo binaries from dist.ipfs.tech
- Latest version detection from GitHub releases API
- Zero configuration required

**Installation:**
```bash
lsh ipfs install
```

**Supported Platforms:**
- ✅ macOS (Intel & Apple Silicon)
- ✅ Linux (amd64 & arm64)
- ✅ Windows (amd64)

**Installation Paths:**
- Binary: `~/.lsh/ipfs/bin/ipfs`
- Repository: `~/.lsh/ipfs/repo/`
- PID File: `~/.lsh/ipfs/daemon.pid`

### 2. IPFS Client Management Commands

**New Commands:**

```bash
# Check installation status
lsh ipfs status
lsh ipfs status --json

# Install IPFS client
lsh ipfs install
lsh ipfs install --version 0.26.0
lsh ipfs install --force

# Uninstall LSH-managed IPFS
lsh ipfs uninstall

# Initialize IPFS repository
lsh ipfs init

# Daemon management
lsh ipfs start
lsh ipfs stop
```

### 3. Enhanced Doctor Command

**What Changed:**
- Added IPFS client health check
- Reports IPFS installation status (type, version, path)
- Warns if IPFS not installed (optional, non-blocking)

**Example Output:**
```
✅ IPFS Client - kubo v0.26.0 installed
   Path: /Users/username/.lsh/ipfs/bin/ipfs
```

### 4. Cross-Platform Binary Management

**Implementation Details:**
- Detects platform (darwin/linux/win32) and architecture (amd64/arm64)
- Downloads appropriate Kubo binary from official distributions
- Extracts and installs to user-local directory
- No root/admin privileges required
- Automatic cleanup of downloaded archives

**Version Management:**
- Fetches latest stable version from GitHub API
- Fallback to Kubo v0.26.0 if API unavailable
- Option to install specific version with `--version` flag

### 5. IPFS Daemon Lifecycle Management

**Capabilities:**
- Initialize IPFS repository at `~/.lsh/ipfs/repo/`
- Start daemon in background
- Track daemon process via PID file
- Stop daemon gracefully
- API access at `http://localhost:5001`
- Gateway access at `http://localhost:8080`

## Documentation

### New Documentation
- **[IPFS_CLIENT_GUIDE.md](../features/ipfs/IPFS_CLIENT_GUIDE.md)** - Comprehensive IPFS client management guide
  - Installation instructions
  - Command reference
  - Troubleshooting
  - Security considerations
  - Advanced usage
  - FAQs

### Updated Documentation
- **[README.md](../../README.md)** - Added IPFS Integration section
- **[1.6.0.md](./1.6.0.md)** - Referenced for IPFS storage context

## Technical Implementation

### New Modules

**`src/lib/ipfs-client-manager.ts`** (456 lines)
- Core IPFS client management logic
- Platform-specific installation methods
- Detection and lifecycle management

**`src/commands/ipfs.ts`** (147 lines)
- CLI command implementations
- User-friendly output with ora spinners
- JSON output option for automation

### Integration Points

**`src/commands/doctor.ts`**
- Added `checkIPFSClient()` health check function
- Integrated into main health check flow
- Provides actionable feedback

**`src/cli.ts`**
- Registered IPFS command group
- Added to command discovery

### Tests

**`__tests__/unit/ipfs-client-manager.test.ts`**
- 7 unit tests covering:
  - Detection logic
  - Directory structure creation
  - Uninstall functionality
  - Platform compatibility
- All tests passing (7/7)

## Benefits

### For Users

**Simplified Setup:**
- No manual IPFS installation required
- One command to get started: `lsh ipfs install`
- Automatic version management

**Cross-Platform:**
- Works on macOS, Linux, and Windows
- Handles architecture differences (Intel, ARM, amd64)
- Consistent experience across platforms

**Optional Feature:**
- IPFS client is optional - LSH works without it
- Local IPFS-compatible storage doesn't require daemon
- Install only if you need full IPFS network features

### For Developers

**Clean Isolation:**
- Installs to user directory (`~/.lsh/ipfs/`)
- No system-wide changes
- Easy cleanup and reinstallation

**API Access:**
- Full IPFS API available at localhost:5001
- Gateway for browsing IPFS content
- Ready for future distributed features

## Usage Examples

### Quick Start

```bash
# Install LSH
npm install -g lsh-framework@1.7.0

# Check if IPFS is installed
lsh ipfs status

# Install IPFS if needed
lsh ipfs install

# Initialize repository
lsh ipfs init

# Start daemon (optional)
lsh ipfs start

# Use LSH secrets as normal
lsh push --env dev
lsh pull --env dev
```

### Automation

```bash
# JSON output for scripts
STATUS=$(lsh ipfs status --json)
INSTALLED=$(echo $STATUS | jq -r '.installed')

if [ "$INSTALLED" = "false" ]; then
  echo "Installing IPFS..."
  lsh ipfs install
fi
```

### Advanced

```bash
# Install specific version
lsh ipfs install --version 0.25.0

# Force reinstall
lsh ipfs install --force

# Check installation in doctor
lsh doctor --verbose
```

## Migration Guide

No migration required! This is a purely additive feature.

**For existing users:**
- LSH continues to work exactly as before
- IPFS client is optional
- No changes to existing workflows

**To use new features:**
```bash
# Update to v1.7.0
npm install -g lsh-framework@1.7.0

# Install IPFS client
lsh ipfs install
```

## Performance

### Installation Speed
- **Download:** ~50MB binary (varies by platform)
- **Installation:** < 30 seconds on most systems
- **Verification:** Instant

### Resource Usage
- **Disk:** ~60MB (binary + repository)
- **Memory:** Minimal when daemon not running
- **CPU:** Only during installation

## Security

### Binary Verification
- Downloads from official IPFS distributions: `https://dist.ipfs.tech/`
- Checksums available at download URLs
- Binaries signed by IPFS team

### Local Installation
- No root/admin privileges required
- Isolated to `~/.lsh/ipfs/` directory
- No system-wide modifications

### Network Security
- Daemon binds to localhost by default
- API requires authentication tokens
- Gateway is read-only

## Breaking Changes

None! This is a fully backward-compatible release.

## Known Issues

None identified.

## Troubleshooting

### Installation Fails

**Problem:** `❌ Installation failed: Failed to download`

**Solutions:**
1. Check internet connection
2. Verify firewall settings
3. Try specific version: `lsh ipfs install --version 0.26.0`

### Daemon Won't Start

**Problem:** `❌ Failed to start daemon: Address already in use`

**Solutions:**
```bash
# Check if IPFS already running
ps aux | grep ipfs

# Stop existing daemon
lsh ipfs stop

# Try starting again
lsh ipfs start
```

## Deprecations

None.

## Future Roadmap

### Coming in v1.7.1
- Performance optimizations for large files
- Improved error messages
- Better progress indicators

### Coming in v1.8.0
- Real IPFS network upload via Storacha
- Distributed secrets sync across team
- Pinning service integration
- Web3.storage backup integration

## Contributors

- IPFS client installation and management system
- Cross-platform binary distribution
- Comprehensive documentation
- Unit test coverage

## Full Changelog

### Added
- `lsh ipfs status` - Check IPFS client installation status
- `lsh ipfs install` - Install IPFS client (Kubo)
- `lsh ipfs uninstall` - Remove LSH-managed IPFS
- `lsh ipfs init` - Initialize IPFS repository
- `lsh ipfs start` - Start IPFS daemon
- `lsh ipfs stop` - Stop IPFS daemon
- `IPFSClientManager` class for client lifecycle management
- IPFS health check in doctor command
- Comprehensive IPFS client documentation

### Changed
- Doctor command now includes IPFS client status check
- README updated with IPFS integration section

### Fixed
- None (new feature release)

### Removed
- None

## Install

```bash
npm install -g lsh-framework@1.7.0
```

## Verify

```bash
lsh --version  # Should show 1.7.0
lsh ipfs status
```

---

**Questions?** Open an issue at https://github.com/gwicho38/lsh/issues
**Documentation:** https://github.com/gwicho38/lsh#readme
**IPFS Guide:** https://github.com/gwicho38/lsh/blob/main/docs/features/ipfs/IPFS_CLIENT_GUIDE.md
