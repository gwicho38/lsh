# Release 3.1.2 - Centralize Hardcoded Values

**Released:** November 30, 2025

## Summary

This release focuses on code quality improvements by centralizing hardcoded values into constants files. This reduces maintenance burden and improves consistency across the codebase.

## Changes

### Refactoring

- Centralized hardcoded values into `src/constants/` files
- Added 37 new `ENV_VARS` to `src/constants/config.ts`
- Added 15+ new `DEFAULTS` (ports, timeouts, URLs)
- Added 15 `ERROR_CODES` for API error handling
- Added 25+ `ENDPOINTS` for SaaS API v1 routes
- Added `EMOJI`, `STATUS_MESSAGES`, `DOCTOR_MESSAGES`, `INIT_MESSAGES` to UI constants
- Added table names to database constants

### Impact

| Category | Before | After | Reduction |
|----------|--------|-------|-----------|
| Total hardcoded values | 233 | 139 | 40% |
| ENV_VAR | 41 | 0 | 100% |
| API_ENDPOINT | 25 | 0 | 100% |

### Developer Tools

- Created `scripts/detect-hardcoded-values.ts` for detecting hardcoded values
- Created `scripts/refactor-constants.ts` for automated refactoring

### Files Changed

21 source files refactored to use constants:
- `src/commands/config.ts`
- `src/commands/self.ts`
- `src/daemon/job-registry.ts`
- `src/daemon/lshd.ts`
- `src/daemon/saas-api-server.ts`
- `src/lib/base-job-manager.ts`
- `src/lib/daemon-client.ts`
- `src/lib/database-persistence.ts`
- `src/lib/ipfs-secrets-storage.ts`
- `src/lib/ipfs-sync-logger.ts`
- `src/lib/logger.ts`
- `src/lib/lsh-config.ts`
- `src/lib/lshrc-init.ts`
- `src/lib/platform-utils.ts`
- `src/lib/saas-auth.ts`
- `src/lib/saas-billing.ts`
- `src/lib/saas-email.ts`
- `src/lib/saas-encryption.ts`
- `src/lib/secrets-manager.ts`
- `src/lib/storacha-client.ts`
- `src/lib/supabase-client.ts`
- `src/services/secrets/secrets.ts`

## Diff Statistics

```
44 files changed, 1722 insertions(+), 205 deletions(-)
```

### New Constants Added

#### ENV_VARS (config.ts)
```typescript
// Platform-specific
APPDATA, LOCALAPPDATA, COMSPEC, USERPROFILE, SYSTEMROOT, TEMP, TMP

// Stripe integration
STRIPE_SECRET_KEY, STRIPE_PUBLISHABLE_KEY, STRIPE_WEBHOOK_SECRET,
STRIPE_PRODUCT_ID, STRIPE_PRICE_ID_STARTER, STRIPE_PRICE_ID_PRO, STRIPE_PRICE_ID_ENTERPRISE

// Resend email
RESEND_API_KEY, RESEND_FROM_EMAIL

// Storacha (IPFS)
LSH_STORACHA_ENABLED, LSH_STORACHA_DID, W3_PRINCIPAL, W3_PROOF

// And more...
```

#### DEFAULTS (config.ts)
```typescript
API_PORT: 3030
SAAS_API_PORT: 3031
KUBO_RELEASES_URL: 'https://api.github.com/repos/ipfs/kubo/releases/latest'
DEFAULT_IPFS_GATEWAY: 'https://w3s.link'
CHECK_INTERVAL_MS: 60000
CLEANUP_INTERVAL_MS: 3600000
DEFAULT_CORS_ORIGINS: ['http://localhost:3000', 'http://localhost:3001']
```

#### ERROR_CODES (errors.ts)
```typescript
UNAUTHORIZED, INVALID_CREDENTIALS, FORBIDDEN, INVALID_INPUT,
NOT_FOUND, INTERNAL_ERROR, TEAM_REQUIRED, INSUFFICIENT_PERMISSIONS,
ENCRYPTION_FAILED, DECRYPTION_FAILED, QUOTA_EXCEEDED,
BILLING_ERROR, PAYMENT_REQUIRED
```

#### ENDPOINTS (api.ts)
```typescript
API_V1_AUTH_SIGNUP, API_V1_AUTH_LOGIN, API_V1_AUTH_VERIFY,
API_V1_ORGANIZATIONS, API_V1_TEAMS, API_V1_TEAM_SECRETS,
API_V1_SECRETS, API_V1_ENCRYPTION_KEYS, API_V1_AUDIT_LOGS,
API_V1_BILLING_SUBSCRIPTION, API_V1_BILLING_PORTAL, API_V1_STRIPE_WEBHOOK
```

#### UI Constants (ui.ts)
```typescript
EMOJI: { SUCCESS, ERROR, WARNING, INFO, ROCKET, KEY, SHIELD, ... }
STATUS_MESSAGES: { RUNNING, STOPPED, STARTING, ... }
DOCTOR_MESSAGES: { HEADING, OK, WARN, ERROR, NOT_CONFIGURED, ... }
INIT_MESSAGES: { SUCCESS, ALREADY_EXISTS, ... }
```

## Full Changelog

https://github.com/gwicho38/lsh/compare/v3.1.1...v3.1.2
