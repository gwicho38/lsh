# Release 3.1.3 - Continue Centralizing Hardcoded Values

**Released:** December 1, 2025

## Summary

This release continues the refactoring effort to centralize hardcoded values into constants files, further reducing maintenance burden and improving code consistency.

## Changes

### New TABLE Constants

Added 7 new table name constants to `src/constants/database.ts`:

```typescript
// ML tables
ML_TRAINING_JOBS: 'ml_training_jobs',
ML_MODELS: 'ml_models',
ML_FEATURES: 'ml_features',

// Views (read-only aggregations)
ORGANIZATION_MEMBERS_DETAILED: 'organization_members_detailed',
ORGANIZATION_USAGE_SUMMARY: 'organization_usage_summary',
TEAM_MEMBERS_DETAILED: 'team_members_detailed',
SECRETS_SUMMARY: 'secrets_summary',
```

### New DEFAULTS Constants

Added to `src/constants/config.ts`:

```typescript
// Cloud sync intervals
CLOUD_CONFIG_SYNC_INTERVAL_MS: 60000, // 1 minute
HISTORY_SYNC_INTERVAL_MS: 30000, // 30 seconds

// Job registry
MAX_RECORDS_PER_JOB: 1000,
MAX_TOTAL_RECORDS: 50000,
METRICS_RETENTION_DAYS: 90,
```

### Files Refactored

11 source files updated to use new constants:

| File | Changes |
|------|---------|
| `src/lib/saas-organizations.ts` | Uses TABLES constants for view queries |
| `src/lib/saas-secrets.ts` | Uses TABLES.SECRETS_SUMMARY |
| `src/services/supabase/supabase-registrar.ts` | Uses TABLES for ML tables |
| `src/daemon/job-registry.ts` | Uses PATHS and DEFAULTS |
| `src/lib/cloud-config-manager.ts` | Uses DEFAULTS.CLOUD_CONFIG_SYNC_INTERVAL_MS |
| `src/lib/enhanced-history-system.ts` | Uses DEFAULTS for history config |
| `src/lib/history-system.ts` | Uses DEFAULTS.MAX_HISTORY_SIZE |
| `src/lib/cron-job-manager.ts` | Uses DEFAULTS for all timeout values |
| `src/lib/daemon-client.ts` | Uses DEFAULTS.MAX_BUFFER_SIZE_BYTES |

### Impact

| Metric | v3.1.2 | v3.1.3 | Change |
|--------|--------|--------|--------|
| Total hardcoded values | 139 | 122 | -12% |
| TABLE_NAME category | 7 | 0 | -100% |
| TIMEOUT category | 4 | 0 | -100% |

### Cumulative Progress (v3.1.2 â†’ v3.1.3)

| Metric | Original (v3.1.1) | Current (v3.1.3) | Total Reduction |
|--------|-------------------|------------------|-----------------|
| Total hardcoded values | 233 | 122 | 48% |
| ENV_VAR | 41 | 0 | 100% |
| API_ENDPOINT | 25 | 0 | 100% |
| TABLE_NAME | 7 | 0 | 100% |
| TIMEOUT | 4 | 0 | 100% |

### Remaining Items

The remaining 122 hardcoded values are primarily:
- **PORT (4)**: Documentation values in `.env.example` template
- **UI_MESSAGE (117)**: CLI help text and UI strings
- **MAGIC_NUMBER (1)**: Already using constant

## Diff Statistics

```
15 files changed, 65 insertions(+), 26 deletions(-)
```

## Full Changelog

https://github.com/gwicho38/lsh/compare/v3.1.2...v3.1.3
