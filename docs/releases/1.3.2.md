# Release Notes: lsh-framework v1.3.2

**Release Date:** November 15, 2025
**Previous Version:** 1.3.1
**Type:** Minor Release (New Feature)

## ðŸŽ¯ Overview

This release adds comprehensive shell completion support for both bash and zsh, making the LSH CLI significantly easier to use with intelligent command, option, and argument suggestions.

## âœ¨ New Features

### Shell Completion System

Added native shell completion support that provides intelligent suggestions for:

- **Commands** - All LSH commands with descriptions (bash/zsh)
- **Options & Flags** - Context-aware option completion based on current command
- **File Paths** - Automatic file and directory completion for file arguments
- **Environment Names** - Suggestions for common environments (dev, staging, production, etc.)
- **Output Formats** - Format suggestions (env, json, yaml, toml, export)

### Installation Methods

**Bash:**
```bash
# Temporary
source <(lsh completion bash)

# Permanent
echo 'source <(lsh completion bash)' >> ~/.bashrc
```

**Zsh:**
```bash
# Temporary
source <(lsh completion zsh)

# Permanent
lsh completion zsh > ~/.zsh/completions/_lsh
# Then add to ~/.zshrc:
# fpath=(~/.zsh/completions $fpath)
# autoload -Uz compinit && compinit
```

## ðŸŽ¨ User Experience Improvements

### Command Discovery

Users can now explore available commands by typing `lsh` and pressing Tab:

```bash
$ lsh <Tab>
help     init     doctor   push     pull     list     ls       env
key      create   sync     status   info     get      set      delete
supabase daemon   cron     self     completion
```

### Option Discovery

Each command shows its available options when Tab is pressed:

```bash
$ lsh get <Tab>
-f --file  --all  --export  --format  --exact  -h --help

$ lsh push --env <Tab>
dev  development  staging  production  prod  test
```

### Smart Completions

The completion system is context-aware:

- File arguments complete with actual file paths
- Environment arguments suggest common environment names
- Format arguments suggest available output formats
- Subcommands complete based on parent command

## ðŸ”§ Technical Changes

### Files Added

**`src/commands/completion.ts`** (NEW - 387 lines)

Complete implementation of shell completion system:

1. **`generateBashCompletion(): string`** (lines 11-207)
   - Generates bash completion script using `_init_completion` and `compgen`
   - Implements context-aware completions with case statements
   - Supports all LSH commands with their specific options
   - Provides file path completion for file arguments
   - Suggests environment names and formats

2. **`generateZshCompletion(): string`** (lines 212-358)
   - Generates zsh completion script using `_arguments` and `_describe`
   - Structured completion specifications for each command
   - Rich descriptions for commands and options
   - Advanced zsh completion features (option grouping, exclusions)

3. **`registerCompletionCommands(program: Command): void`** (lines 363-384)
   - Registers `lsh completion <shell>` command
   - Validates shell type (bash or zsh)
   - Outputs completion script to stdout
   - Provides usage examples for installation

### Files Modified

**`src/cli.ts`**

Added completion command registration:
- Line 12: `import { registerCompletionCommands } from './commands/completion.js';`
- Line 160: `registerCompletionCommands(program);`

### Completion Coverage

All LSH commands are fully supported:

**Secrets Management:**
- `get` - File paths, formats (env/json/yaml/toml/export), exact flag
- `set` - File paths, stdin flag
- `push` / `pull` - File paths, environment names, force flag
- `sync` - File paths, environment names, dry-run, legacy, load, force flags
- `list` / `ls` - File paths, formats, keys-only, no-mask flags
- `env` - Environment names, formats, all-files flag
- `key` - Export flag
- `create` - File paths, template flag
- `delete` - File paths, yes flag
- `status` / `info` - File paths, environment names

**Services:**
- `supabase` - Help flag (subcommands support planned)
- `daemon` - Help flag (subcommands support planned)
- `cron` - Help flag (subcommands support planned)
- `self` - Help flag (subcommands support planned)

**Setup:**
- `init` / `doctor` - Help flag
- `completion` - Shell type (bash/zsh)

## ðŸ“š Documentation

### New Documentation

**`docs/features/SHELL_COMPLETION.md`** (NEW)

Comprehensive guide covering:
- Installation instructions for bash and zsh
- Temporary and permanent installation methods
- Usage examples for all completion types
- Troubleshooting guide
- Technical details about completion systems

## ðŸ§ª Testing

### Validation Tests

All completion features tested and verified:

```bash
# Script generation
lsh completion bash  âœ… Generates valid bash script
lsh completion zsh   âœ… Generates valid zsh script

# Installation
source <(lsh completion bash)  âœ… Loads without errors
source <(lsh completion zsh)   âœ… Loads without errors

# Command completion
lsh <Tab>  âœ… Shows all commands

# Option completion
lsh get <Tab>  âœ… Shows get options
lsh push --env <Tab>  âœ… Shows environment names

# File completion
lsh set -f <Tab>  âœ… Shows file paths

# Format completion
lsh list --format <Tab>  âœ… Shows format options
```

## ðŸ”„ Breaking Changes

None. This is a purely additive feature.

## ðŸŽ Benefits

1. **Faster Command Entry** - Tab completion reduces typing
2. **Command Discovery** - Explore available commands without consulting docs
3. **Fewer Errors** - Suggestions prevent typos and invalid options
4. **Better UX** - Modern CLI experience expected by users
5. **Learning Curve** - New users can discover features through completion

## ðŸ“Š Diff Summary

```
Files Changed:
- src/commands/completion.ts        (+387 lines, NEW)
- src/cli.ts                        (+2 lines)
- docs/features/SHELL_COMPLETION.md (+300+ lines, NEW)

Functions Added:
- generateBashCompletion()
- generateZshCompletion()
- registerCompletionCommands()

Total: 2 files modified, 2 files created
Lines: +689 insertions
```

## ðŸ“¦ Installation

```bash
npm install -g lsh-framework@1.3.2
# or
npm update -g lsh-framework

# Then install completion
lsh completion bash >> ~/.bashrc  # For bash
# or
lsh completion zsh > ~/.zsh/completions/_lsh  # For zsh
```

## ðŸ”œ Future Improvements

- Dynamic secret key completion (show actual keys from .env)
- Completion for daemon/supabase/cron subcommands
- Fish shell support
- PowerShell support (Windows)
- Completion caching for faster performance
- Custom completion extensions via plugins

## ðŸ’¡ Usage Tips

**Quick Setup:**

```bash
# Bash users
echo 'source <(lsh completion bash)' >> ~/.bashrc && source ~/.bashrc

# Zsh users
mkdir -p ~/.zsh/completions && \
  lsh completion zsh > ~/.zsh/completions/_lsh && \
  echo 'fpath=(~/.zsh/completions $fpath)' >> ~/.zshrc && \
  echo 'autoload -Uz compinit && compinit' >> ~/.zshrc && \
  source ~/.zshrc
```

**Exploring Commands:**

Just type `lsh` and press Tab repeatedly to browse all available commands and their options!

## ðŸ‘¥ Contributors

- Claude Code

---

**Full Changelog:** v1.3.1...v1.3.2

**Documentation:** [Shell Completion Guide](../features/SHELL_COMPLETION.md)
