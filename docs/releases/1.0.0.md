# LSH v1.0.0 - Flattened Command Structure

**Release Date:** 2025-11-06

## üéâ Major Release: v1.0.0

This is a **major breaking change** release that simplifies the command structure by removing the `lib` prefix from all commands.

## Breaking Changes

### Command Structure Flattening

All commands that were previously nested under `lsh lib` are now available as top-level commands:

| Old Command (v0.x) | New Command (v1.0+) |
|-------------------|---------------------|
| `lsh lib secrets push` | `lsh push` |
| `lsh lib secrets pull` | `lsh pull` |
| `lsh lib secrets list` | `lsh list` |
| `lsh lib secrets key` | `lsh key` |
| `lsh lib secrets sync` | `lsh sync` |
| `lsh lib daemon start` | `lsh daemon start` |
| `lsh lib daemon status` | `lsh daemon status` |
| `lsh lib cron add` | `lsh cron add` |
| `lsh lib cron list` | `lsh cron list` |
| `lsh lib api start` | `lsh api start` |
| `lsh lib supabase ...` | `lsh supabase ...` |

### Why This Change?

1. **Simpler UX** - Less typing, easier to remember
2. **Industry Standard** - Matches patterns from git, docker, kubectl
3. **Better Discoverability** - Flat hierarchy is easier to explore
4. **Cleaner Documentation** - Less noise in examples

### Migration Guide

#### For Scripts and Automation

**Search and Replace:**
```bash
# In your scripts, replace:
lsh lib secrets push  ‚Üí  lsh push
lsh lib secrets pull  ‚Üí  lsh pull
lsh lib daemon start  ‚Üí  lsh daemon start
lsh lib cron add      ‚Üí  lsh cron add
```

#### For CI/CD Pipelines

Update your `.github/workflows`, `.gitlab-ci.yml`, or other pipeline configs:

**Before:**
```yaml
- name: Pull secrets
  run: lsh lib secrets pull --env prod
```

**After:**
```yaml
- name: Pull secrets
  run: lsh pull --env prod
```

#### For Cron Jobs

If you have scheduled jobs that use LSH:

**Before:**
```bash
lsh lib cron add \
  --name "rotate-keys" \
  --schedule "0 0 1 * *" \
  --command "./rotate.sh && lsh lib secrets push"
```

**After:**
```bash
lsh cron add \
  --name "rotate-keys" \
  --schedule "0 0 1 * *" \
  --command "./rotate.sh && lsh push"
```

### Backward Compatibility

The old `lsh lib` commands **still work** but will show deprecation warnings:

```bash
$ lsh lib daemon status
‚ö†Ô∏è  WARNING: "lsh lib" commands are deprecated as of v1.0.0
   Use top-level commands instead:
   - lsh daemon (instead of lsh lib daemon)
   - lsh cron (instead of lsh lib cron)
   - lsh api (instead of lsh lib api)
   - lsh supabase (instead of lsh lib supabase)
```

**Deprecation Timeline:**
- **v1.0.x** - Warnings shown, old commands still work
- **v1.1.0** - Warnings become more prominent
- **v2.0.0** - Old `lib` commands will be removed

## New Features

### Improved Help Output

```bash
$ lsh --help
LSH - Encrypted Secrets Manager with Automatic Rotation

üîê Secrets Management (Primary Features):
  sync                    Check sync status & get recommendations
  push                    Upload .env to encrypted cloud storage
  pull                    Download .env from cloud storage
  list                    List secrets in current local .env file
  env [name]              List/view cloud environments
  key                     Generate encryption key

üîÑ Automation (Schedule secret rotation):
  cron add                Schedule automatic tasks
  cron list               List scheduled jobs
  daemon start            Start persistent daemon

üìö More Commands:
  api                     API server management
  supabase                Supabase database management
  daemon                  Daemon management
  cron                    Cron job management
  self                    Self-management commands
```

### Better Command Discovery

All commands are now at the top level:
```bash
$ lsh <TAB><TAB>
push        pull        list        env         key
create      sync        status      get         set
delete      daemon      cron        api         supabase
self        config      help        repl
```

## Updated Documentation

All documentation has been updated to reflect the new command structure:

- ‚úÖ README.md
- ‚úÖ CLAUDE.md (project instructions)
- ‚úÖ SECRETS_GUIDE.md
- ‚úÖ SECRETS_QUICK_REFERENCE.md
- ‚úÖ SMART_SYNC_GUIDE.md

## Examples

### Quick Start (New Commands)

```bash
# Generate encryption key
lsh key

# Push secrets
lsh push --env dev

# Pull on another machine
lsh pull --env dev

# Schedule rotation
lsh cron add \
  --name "rotate-keys" \
  --schedule "0 0 1 * *" \
  --command "./rotate.sh && lsh push"
```

### Smart Sync

```bash
# Auto-setup and sync
lsh sync

# Sync and load into shell
eval "$(lsh sync --load)"
```

### Daemon Management

```bash
# Start daemon
lsh daemon start

# Check status
lsh daemon status

# List jobs
lsh daemon job list
```

## Implementation Details

### Architecture Changes

**File Changes:**
- `src/cli.ts` - Flattened command registration
- `src/services/lib/lib.ts` - Added deprecation warnings
- Updated help text throughout

**Command Registration:**
```typescript
// Before
const libCommand = await init_lib(program);
await init_daemon(libCommand);
await init_cron(libCommand);

// After
await init_daemon(program);  // Top-level
await init_cron(program);    // Top-level
```

### Testing

All tests pass with the new structure:
- ‚úÖ CLI routing tests updated
- ‚úÖ Command execution tests pass
- ‚úÖ Backward compatibility verified
- ‚úÖ Deprecation warnings tested

## Upgrade Instructions

### 1. Install v1.0.0

```bash
npm install -g lsh-framework@1.0.0
```

### 2. Update Your Scripts

Run a search in your project:
```bash
grep -r "lsh lib" .
```

Replace all instances:
```bash
# macOS
find . -type f -name "*.sh" -exec sed -i '' 's/lsh lib secrets/lsh/g' {} +
find . -type f -name "*.sh" -exec sed -i '' 's/lsh lib daemon/lsh daemon/g' {} +
find . -type f -name "*.sh" -exec sed -i '' 's/lsh lib cron/lsh cron/g' {} +

# Linux
find . -type f -name "*.sh" -exec sed -i 's/lsh lib secrets/lsh/g' {} +
find . -type f -name "*.sh" -exec sed -i 's/lsh lib daemon/lsh daemon/g' {} +
find . -type f -name "*.sh" -exec sed -i 's/lsh lib cron/lsh cron/g' {} +
```

### 3. Test Your Workflows

```bash
# Test secrets sync
lsh sync

# Test daemon
lsh daemon status

# Test cron jobs
lsh cron list
```

## Rollback Instructions

If you need to rollback:

```bash
npm install -g lsh-framework@0.10.2
```

## Changelog

### Changed
- **[BREAKING]** Flattened all commands - removed `lib` prefix
- Updated all documentation and examples
- Improved help text and command discovery

### Added
- Deprecation warnings for old `lib` commands
- Better help output with emoji categories
- Comprehensive migration guide

### Deprecated
- `lsh lib daemon` ‚Üí Use `lsh daemon`
- `lsh lib cron` ‚Üí Use `lsh cron`
- `lsh lib api` ‚Üí Use `lsh api`
- `lsh lib supabase` ‚Üí Use `lsh supabase`
- `lsh lib secrets *` ‚Üí Use `lsh *` (push, pull, list, etc.)

### Fixed
- Command structure consistency
- Help text clarity
- Documentation alignment

## Credits

Thanks to all users who provided feedback on the command structure!

---

**Full Changelog**: https://github.com/gwicho38/lsh/compare/v0.10.2...v1.0.0
