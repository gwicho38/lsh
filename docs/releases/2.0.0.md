# Release Notes: v2.0.0

**Release Date:** 2024-11-24
**Type:** Major Version - Breaking Changes

## ğŸ‰ Overview

LSH v2.0 introduces a **simpler, more intuitive** environment naming system for git repositories. The default environment is now the repository name itself, eliminating confusion about "dev" being appended automatically.

## ğŸš¨ Breaking Changes

### New Default Environment Behavior

**v1.x (Old Behavior)**:
```bash
# In repository: lsh_test_repo
lsh push                    # â†’ stored as: lsh_test_repo_dev
lsh push --env dev          # â†’ stored as: lsh_test_repo_dev
lsh push --env staging      # â†’ stored as: lsh_test_repo_staging
```

**v2.0 (New Behavior)**:
```bash
# In repository: lsh_test_repo
lsh push                    # â†’ stored as: lsh_test_repo (simpler!)
lsh push --env dev          # â†’ stored as: lsh_test_repo_dev (explicit)
lsh push --env staging      # â†’ stored as: lsh_test_repo_staging
```

###Outside Git Repositories (No Change)
```bash
# Not in a git repository
lsh push                    # â†’ stored as: dev (unchanged)
lsh push --env production   # â†’ stored as: production (unchanged)
```

## âœ¨ New Features

### 1. Context-Aware Default Environments

The default environment is now determined by your context:
- **In a git repository**: Default = repository name
- **Outside git repos**: Default = `dev` (unchanged)

This makes the most common use case (one repo = one environment) much simpler.

### 2. Migration Command

New `lsh migrate` command to help transition from v1.x:

```bash
# See migration guidance
lsh migrate

# Enable v1.x compatibility mode
lsh migrate --v1-compat

# Dry run to see what would happen
lsh migrate --dry-run
```

### 3. Backward Compatibility Mode

For teams that need time to transition:

```bash
# Enable v1.x behavior
export LSH_V1_COMPAT=true

# Now works like v1.x
lsh push  # â†’ repo_dev (old format)
```

Add to your `~/.bashrc` or `~/.zshrc` to make permanent.

## ğŸ“Š Migration Guide

### Scenario 1: Solo Developer

**Quick Migration**:
```bash
# 1. Update LSH
npm update -g lsh-framework@2.0.0

# 2. Check current status
cd your-repo
lsh migrate

# 3. Start using new format
lsh push  # Now uses repo name as environment
```

**Your v1.x data is still accessible**:
```bash
# Access old dev environment explicitly
lsh pull --env dev  # â†’ pulls from repo_dev (v1.x format)

# Use new default
lsh pull            # â†’ pulls from repo (v2.0 format)
```

### Scenario 2: Team Migration

**Coordinated Approach** (Recommended):

1. **Announce Migration**:
   ```
   Team: Upgrading to LSH v2.0 on [date]
   Everyone should update: npm update -g lsh-framework@2.0.0
   ```

2. **Primary Host (Coordinator)**:
   ```bash
   # Update
   npm update -g lsh-framework@2.0.0

   # Push to new format
   cd your-repo
   lsh push  # Creates new v2.0 environment
   ```

3. **Other Team Members**:
   ```bash
   # Update
   npm update -g lsh-framework@2.0.0

   # Pull from new environment
   cd your-repo
   lsh pull  # Gets v2.0 environment
   ```

**Gradual Approach** (Use compatibility mode):

```bash
# Team members who aren't ready
export LSH_V1_COMPAT=true  # Keep v1.x behavior
lsh push                    # Still uses repo_dev

# When ready to switch
unset LSH_V1_COMPAT
lsh push                    # Now uses v2.0 format
```

### Scenario 3: Multiple Environments (Dev/Staging/Prod)

**Good News**: Only the default (previously `_dev`) is affected!

```bash
# v1.x
lsh push --env dev        # â†’ repo_dev
lsh push --env staging    # â†’ repo_staging
lsh push --env production # â†’ repo_production

# v2.0
lsh push                  # â†’ repo (new default!)
lsh push --env dev        # â†’ repo_dev (same as v1.x)
lsh push --env staging    # â†’ repo_staging (unchanged)
lsh push --env production # â†’ repo_production (unchanged)
```

**Migration Strategy**:
- Keep using `--env dev` for your development environment (no change)
- Or switch to the new default (no `--env` flag)
- Staging and production environments work exactly the same

## ğŸ”§ Technical Changes

### Core Changes

**File**: `src/lib/secrets-manager.ts`

1. **New Method**: `getDefaultEnvironment()`
   - Returns empty string (signals "repo name only") in git repos
   - Returns `'dev'` outside git repos
   - Respects `LSH_V1_COMPAT` environment variable

2. **Updated Method**: `getRepoAwareEnvironment(environment: string)`
   - Empty environment â†’ returns just repo name
   - Named environment â†’ returns `repo_env` (unchanged)
   - Outside repos â†’ returns environment as-is

**File**: `src/services/secrets/secrets.ts`

- Updated `push`, `pull`, and `sync` commands to use dynamic defaults
- Checks if `--env` was explicitly passed or is default value
- Applies v2.0 logic only when using default

**File**: `src/commands/migrate.ts`

- New migration guidance command
- Checks for v1.x data
- Provides clear upgrade path
- Supports compatibility mode

### Backward Compatibility

Set `LSH_V1_COMPAT=true` to keep v1.x behavior:

```bash
# Temporary
LSH_V1_COMPAT=true lsh push

# Permanent (add to shell profile)
export LSH_V1_COMPAT=true
```

## ğŸ¯ Benefits

### For New Users
- **Simpler**: One repo = one environment (no extra `_dev`)
- **Intuitive**: Default behavior matches expectations
- **Less cognitive load**: No need to remember default suffixes

### For Existing Users
- **Cleaner naming**: `lsh_test_repo` vs `lsh_test_repo_dev`
- **More obvious**: Default is clear (repo name)
- **Backward compatible**: V1.x data still accessible with `--env dev`
- **Explicit multi-env**: Use `--env` when you need it

## ğŸ“š Documentation Updates

Updated documentation:
- [Migration Plan](../v2-migration-plan.md) - Comprehensive migration guide
- [Secrets Guide](../features/secrets/SECRETS_GUIDE.md) - Updated for v2.0
- [Quick Reference](../features/secrets/SECRETS_QUICK_REFERENCE.md) - New examples
- [README.md](../../README.md) - Updated all examples

## âš ï¸ Important Notes

### Your Data is Safe
- **V1.x environments still exist** in IPFS/cache
- **Access anytime** with `--env dev`
- **No data loss** - both formats coexist

### When to Use `--env dev`
- Accessing v1.x `repo_dev` environments
- Explicit "development" environment naming
- Working with teams still on v1.x (with compat mode)

### When to Use Default (No `--env`)
- New projects starting with v2.0
- Simplified single-environment repos
- Taking advantage of intuitive defaults

## ğŸ› Known Issues

### Issue: Mixed Version Teams
If some team members are on v1.x and others on v2.0, they'll use different environments by default.

**Solution**:
- Coordinate upgrade across team
- Or use `LSH_V1_COMPAT=true` on v2.0 clients temporarily
- Or explicitly use `--env dev` for consistency

### Issue: Orphaned V1.x Environments
Old `repo_dev` environments remain in IPFS after migration.

**Solution**:
- Keep them for history/rollback
- Or clean up manually:
  ```bash
  # List all environments
  lsh env

  # Delete old v1.x format (if desired)
  rm -rf ~/.lsh/secrets-cache/*_dev*
  ```

## ğŸ“¦ Installation

```bash
# New installation
npm install -g lsh-framework@2.0.0

# Upgrade from v1.x
npm update -g lsh-framework

# Verify version
lsh --version  # Should show 2.0.0
```

## ğŸ”„ Rollback

If you need to roll back to v1.x:

```bash
# Install specific v1.x version
npm install -g lsh-framework@1.8.2

# Your v1.x data is still intact
lsh pull --env dev
```

## ğŸ™ Credits

This change was suggested by a user who found the v1.x default behavior confusing. Thank you for the feedback that made LSH better for everyone!

## ğŸ“ Upgrade Checklist

- [ ] Update LSH: `npm update -g lsh-framework@2.0.0`
- [ ] Run migration guide: `lsh migrate`
- [ ] Test in development repo first
- [ ] Coordinate with team (if applicable)
- [ ] Update CI/CD scripts (if they use `lsh`)
- [ ] Update documentation/runbooks
- [ ] Consider compatibility mode if needed

## ğŸš€ Next Steps

After upgrading:

1. **Run migration guide**:
   ```bash
   lsh migrate
   ```

2. **Test the new default**:
   ```bash
   cd your-repo
   lsh push  # Uses repo name
   ```

3. **Update team**:
   - Share this release notes
   - Coordinate upgrade timing
   - Plan migration approach

## ğŸ“ Support

- **Issues**: https://github.com/gwicho38/lsh/issues
- **Discussions**: https://github.com/gwicho38/lsh/discussions
- **Documentation**: https://github.com/gwicho38/lsh#readme

---

**Thank you for using LSH!** We believe v2.0 makes secrets management simpler and more intuitive. Your feedback drove this improvement. ğŸ‰
