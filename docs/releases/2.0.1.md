# Release Notes: v2.0.1

**Release Date:** 2024-11-24
**Type:** Hotfix - Critical Bug Fix

## üö® Critical Bug Fix

### Empty Environment Not Transformed (v2.0.0)

**Issue**: When using the v2.0 default environment (no `--env` flag), the environment name was not being transformed from empty string to repo name before storage/retrieval. This caused push/pull operations to fail silently.

**User Evidence**:
```bash
# Host A
lsh push
Environment:     ‚Üê EMPTY! Should show "lsh_test_repo"

# Host B
lsh pull
‚ùå Failed to pull secrets: No secrets found for environment:
```

**Root Cause**: The `push()` method in `SecretsManager` was using the raw `environment` parameter (empty string from v2.0 default) throughout the method instead of the transformed `effectiveEnv` value.

**Fix**: Updated `src/lib/secrets-manager.ts` line 230 to compute `effectiveEnv` at the start of `push()` and use it consistently throughout:

```typescript
async push(envFilePath: string = '.env', environment: string = 'dev', force: boolean = false): Promise<void> {
  // ... validation ...

  // Get the effective environment name (repo-aware)
  const effectiveEnv = this.getRepoAwareEnvironment(environment);

  // Use effectiveEnv everywhere instead of raw environment parameter
  logger.info(`Pushing ${envFilePath} to IPFS (${effectiveEnv})...`);

  // ... rest of method uses effectiveEnv ...
}
```

**Lines Changed**:
- Line 230: Added `const effectiveEnv = this.getRepoAwareEnvironment(environment);`
- Line 240: Updated logging to use `effectiveEnv`
- Lines 249-253: Updated destructive change check to use `effectiveEnv`
- Line 280: Updated secret object to use `environment: effectiveEnv`
- Line 288: Updated storage.push() call to use `effectiveEnv`
- Line 298: Updated audit log to use `effectiveEnv`

## üéØ What This Fixes

### Before (v2.0.0 - Broken)
```bash
cd lsh_test_repo
lsh push                    # Environment field empty - BROKEN
lsh pull                    # No secrets found - BROKEN
```

### After (v2.0.1 - Fixed)
```bash
cd lsh_test_repo
lsh push                    # Environment: lsh_test_repo ‚úÖ
lsh pull                    # Successfully pulls secrets ‚úÖ
```

## üì¶ Installation

```bash
# Upgrade from v2.0.0
npm update -g lsh-framework

# Verify version
lsh --version  # Should show 2.0.1
```

## ‚ö†Ô∏è For v2.0.0 Users

If you pushed secrets with v2.0.0, they may have been stored with an empty environment name and are inaccessible. To recover:

**Option 1: Re-push with v2.0.1**
```bash
npm update -g lsh-framework@2.0.1
lsh push  # This will correctly store with repo name
```

**Option 2: Downgrade to v1.8.2 temporarily**
```bash
npm install -g lsh-framework@1.8.2
lsh push --env dev  # Use explicit v1.x format
npm install -g lsh-framework@2.0.1
```

## üîÑ Multi-Host Sync

After upgrading to v2.0.1 on all hosts, multi-host sync will work correctly:

```bash
# Host A
cd lsh_test_repo
lsh push        # Stores as "lsh_test_repo"

# Host B
cd lsh_test_repo
lsh pull        # Retrieves from "lsh_test_repo" ‚úÖ
```

## üìù Diff from v2.0.0

**File**: `src/lib/secrets-manager.ts`

**Changes**:
- Added environment transformation at start of push()
- Consistent use of transformed environment name throughout push()
- Fixed empty environment display in logs
- Fixed IPFS storage with correct environment name

## üôè Credits

Thank you to the user who reported this critical issue immediately after v2.0.0 release. Quick feedback like this helps us fix bugs before they affect more users!

## üìû Support

- **Issues**: https://github.com/gwicho38/lsh/issues
- **Discussions**: https://github.com/gwicho38/lsh/discussions
- **Documentation**: https://github.com/gwicho38/lsh#readme

---

**Apologies for the v2.0.0 bug!** This hotfix restores the intended v2.0 behavior where environment names default to the repository name in git repos.
