# Release 3.1.5 - Expanded Secrets Test Coverage

**Released:** December 1, 2025

## Summary

This release significantly expands the test coverage for secrets management, the primary feature of LSH. Added 22 new test cases covering previously untested code paths.

## Changes

### New Test Cases

Added 22 new tests to `__tests__/secrets-manager.test.ts`:

**SmartSync Method (6 tests)**
- No local and no cloud scenario
- Local exists but cloud does not
- Cloud exists but local does not
- Dry-run mode (autoExecute=false)
- Load mode with export commands
- Key mismatch without force-rekey

**Generate Export Commands (4 tests)**
- Basic export generation
- Skip comments and empty lines
- Handle non-existent file
- Escape special characters

**Sync/Status Methods (5 tests)**
- Sync status for non-existent environment
- Suggest push when local exists but not cloud
- Suggest pull when cloud exists but not local
- Status with cloud exists and keys
- Show with formats (JSON, empty)

**Other Coverage (7 tests)**
- Show with JSON format
- Show with no secrets message
- Default environment in non-git context
- Default environment in global mode
- Cleanup method
- Invalid filename validation (push/pull)
- LSH key preservation on pull

### Coverage Improvement

| Metric | Before | After | Change |
|--------|--------|-------|--------|
| Statements | 50.49% | 74.65% | +24.16% |
| Branches | 43.91% | 68.54% | +24.63% |
| Functions | 83.78% | 97.29% | +13.51% |
| Lines | 50.29% | 74.45% | +24.16% |

### Test Statistics

- Total tests: 1158 (22 new)
- All tests pass
- No new dependencies

## Diff Statistics

```
1 file changed, 283 insertions(+), 2 deletions(-)
```

## Related Issues

Part of Issue #88: Add comprehensive test suite for secrets management

## Full Changelog

https://github.com/gwicho38/lsh/compare/v3.1.4...v3.1.5
