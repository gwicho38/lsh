# Release Notes: v1.4.0

**Release Date:** November 20, 2025

## üöÄ Major Features

### 1. Multi-Tier Storage System

LSH now supports three deployment tiers for maximum flexibility:

#### Local-Only Mode (New! ‚ú®)
- **Zero configuration required**
- Works immediately after `npm install -g lsh-framework`
- Data stored in `~/.lsh/data/storage.json`
- Perfect for trying out LSH or single-user setups

```bash
npm install -g lsh-framework
lsh --version  # Works immediately!
```

#### Local PostgreSQL Mode (New! ‚ú®)
- Easy setup via Docker Compose
- Full database features locally
- Includes pgAdmin for SQL access

```bash
docker-compose up -d
lsh daemon start
```

#### Supabase Cloud Mode
- Team collaboration (unchanged)
- Multi-machine sync
- Cloud backup

**Breaking Changes:** None - fully backward compatible

### 2. Configuration File System (New! ‚ú®)

Introduced centralized configuration at `~/.config/lsh/lshrc`

#### New `lsh config` Command
```bash
lsh config              # Edit in $EDITOR
lsh config set KEY val  # Set value
lsh config get KEY      # Get value
lsh config list         # List all (secrets masked)
```

#### Benefits
- **Single source of truth** for all LSH settings
- **Persistent configuration** across sessions
- **No more .env pollution** - keep `.env` for app secrets only
- **Team-friendly** - share config values easily
- **Auto-loading** on LSH startup

#### File Format
Standard `.env` format at `~/.config/lsh/lshrc`:
```bash
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-key
LSH_SECRETS_KEY=your-encryption-key
```

**Migration:** Existing `.env` configurations continue to work. Gradually migrate to `lshrc` with `lsh config set`.

## üì¶ New Components

### Files Added
- `src/lib/local-storage-adapter.ts` - Local file storage implementation
- `src/lib/config-manager.ts` - Configuration file parser and manager
- `src/commands/config.ts` - Config management CLI commands
- `docker-compose.yml` - Local PostgreSQL setup
- `scripts/init-db.sql` - Database schema initialization
- `docs/QUICK_START.md` - Comprehensive onboarding guide
- `docs/LOCAL_STORAGE.md` - Local storage documentation
- `docs/CONFIGURATION.md` - Configuration system guide

### Files Modified
- `src/lib/database-persistence.ts` - Auto-detect storage backend
- `src/lib/supabase-client.ts` - Made Supabase optional
- `src/lib/env-validator.ts` - Storage mode detection
- `src/cli.ts` - Config auto-loading and command registration
- `README.md` - Updated quick start

## üîß Improvements

### Smart Storage Detection
LSH now automatically detects which storage backend to use:
1. **Supabase** (if `SUPABASE_URL` + `SUPABASE_ANON_KEY` configured)
2. **PostgreSQL** (if `DATABASE_URL` configured)
3. **Local Storage** (fallback - no config needed)

Shows helpful messages:
```
‚ÑπÔ∏è  Environment Variable Recommendations:
  - No database configured - using local file storage (~/.lsh/data/storage.json)
  - For team collaboration, configure SUPABASE_URL and SUPABASE_ANON_KEY
  - For local PostgreSQL, run: docker-compose up -d
```

### Enhanced Error Handling
- If Supabase is configured but fails, throws clear error (no silent fallback)
- Better validation messages for missing configuration

## üìö Documentation

### New Guides
- **[QUICK_START.md](../QUICK_START.md)** - Three deployment options with step-by-step setup
- **[LOCAL_STORAGE.md](../LOCAL_STORAGE.md)** - Local storage technical details
- **[CONFIGURATION.md](../CONFIGURATION.md)** - Complete configuration reference

### Updated Guides
- **[README.md](../../README.md)** - New quick start emphasizing zero-config setup
- **[CLAUDE.md](../../CLAUDE.md)** - Updated project overview

## üêõ Bug Fixes

- Fixed DatabasePersistence to not initialize local storage when Supabase is configured
- Added proper non-null assertions for TypeScript strict mode
- Fixed environment variable precedence issues

## üìä Statistics

- **New Lines of Code:** ~1,200
- **New Test Coverage:** Local storage adapter fully tested
- **Documentation Pages:** +3 comprehensive guides
- **Breaking Changes:** 0
- **New Commands:** 8 config subcommands

## üîÑ Migration Guide

### From v1.3.x to v1.4.0

**No action required** - this release is fully backward compatible.

**Optional: Migrate to config file**
```bash
# Initialize config file
lsh config init

# Migrate your settings
lsh config set SUPABASE_URL "$(echo $SUPABASE_URL)"
lsh config set SUPABASE_ANON_KEY "$(echo $SUPABASE_ANON_KEY)"
lsh config set LSH_SECRETS_KEY "$(echo $LSH_SECRETS_KEY)"

# Verify
lsh config list
```

**Optional: Try local-only mode**
```bash
# Temporarily disable Supabase
lsh config delete SUPABASE_URL
lsh config delete SUPABASE_ANON_KEY

# LSH now uses local storage
lsh daemon status
# Output: ‚ö†Ô∏è  Supabase not configured - using local storage fallback
```

## üéØ Use Cases Enabled

### New User Onboarding
```bash
# Before v1.4.0: Required Supabase setup
# After v1.4.0: Works immediately
npm install -g lsh-framework
lsh --version
lsh push  # Works with local storage!
```

### Development Teams
```bash
# Team lead: Share one-time config
lsh config set SUPABASE_URL https://team-project.supabase.co
lsh config set LSH_SECRETS_KEY shared-key

# Team members: Same setup on their machines
# Now everyone can sync
lsh pull --env production
```

### CI/CD Pipelines
```bash
# Use local storage in CI (no database needed)
- npm install -g lsh-framework
- lsh pull --env ci
- npm test
```

## üîó Related Issues

- Closes #96 - Multi-tier onboarding with local storage fallback

## üì¶ Installation

```bash
# Upgrade to v1.4.0
npm install -g lsh-framework@1.4.0

# Or upgrade existing installation
npm update -g lsh-framework
```

## üôè Contributors

- Built with Claude Code
- Testing and feedback from the community

## üìù Notes

### Performance
- Local storage: ~5s auto-flush, in-memory cache
- PostgreSQL: Full SQL query capabilities
- Supabase: Cloud-backed with real-time sync

### Security
- Secrets still AES-256 encrypted in all modes
- Config file permissions: 600 (owner-only)
- No plaintext secrets stored

### Future Enhancements
- [ ] Data migration tool between storage backends
- [ ] Local SQLite option (lighter than PostgreSQL)
- [ ] Storage backend performance benchmarks
- [ ] Team sync over local network (without cloud)

---

**Full Changelog:** https://github.com/gwicho38/lsh/compare/v1.3.2...v1.4.0
