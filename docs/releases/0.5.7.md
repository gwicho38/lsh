# Release Notes - Version 0.5.7

**Release Date:** 2025-10-15
**Previous Version:** 0.5.6

## Summary

This release improves the secrets management system with better error handling and helpful instructions when decryption fails.

## Bug Fixes

### Secrets Manager Error Handling

**Problem:** When `lsh secrets pull` or `lsh secrets show` failed with a cryptic error:
```
❌ Failed to show secrets: error:1C800064:Provider routines::bad decrypt
```

This error occurred when:
- The encryption key used to encrypt data didn't match the decryption key
- `LSH_SECRETS_KEY` wasn't set on the machine trying to decrypt
- Secrets were encrypted on one machine and being pulled on another

**Solution:** Added comprehensive error handling with clear instructions:

```
Decryption failed. This usually means:
  1. You need to set LSH_SECRETS_KEY environment variable
  2. The key must match the one used during encryption
  3. Generate a shared key with: lsh secrets key
  4. Add it to your .env: LSH_SECRETS_KEY=<key>
```

### Secrets Manager Warnings

Added warning when pushing secrets without `LSH_SECRETS_KEY` set:
```
⚠️  Warning: No LSH_SECRETS_KEY set. Using machine-specific key.
   To share secrets across machines, generate a key with: lsh secrets key
   Then add LSH_SECRETS_KEY=<key> to your .env on all machines
```

## Changes

### Modified Files
- `src/lib/secrets-manager.ts`
  - Improved `decrypt()` method with try-catch and helpful error messages
  - Added warning in `push()` when LSH_SECRETS_KEY is not set
  - Better error context for debugging

## Usage Guide

### Setting Up Shared Secrets

1. **Generate a shared encryption key:**
   ```bash
   lsh secrets key
   ```

2. **Add the key to your environment on ALL machines:**
   ```bash
   # Add to .env or shell rc file
   export LSH_SECRETS_KEY=<generated-key>
   ```

3. **Push secrets from source machine:**
   ```bash
   lsh secrets push
   ```

4. **Pull secrets on other machines:**
   ```bash
   lsh secrets pull
   ```

### Why This Matters

Without `LSH_SECRETS_KEY`, each machine generates its own key based on hostname and username. This means:
- ✅ Secrets work on the same machine
- ❌ Secrets can't be shared across machines
- ❌ Decryption fails with cryptic errors

With `LSH_SECRETS_KEY` set:
- ✅ Same key on all machines
- ✅ Secrets sync properly
- ✅ Team collaboration works

## Installation

```bash
npm install -g lsh-framework
```

## Updating

```bash
lsh self update
```

## Version Diff (0.5.6 → 0.5.7)

### Bug Fixes
- Better error messages for decryption failures
- Warning when pushing without shared key
- Improved debugging information

### User Experience
- Clear instructions on how to fix decryption errors
- Proactive warnings to prevent issues
- Better documentation of encryption key requirements

## Breaking Changes

None - this is a backward compatible bug fix release.

## Migration Notes

No migration needed. If you're experiencing decryption errors:
1. Generate a key: `lsh secrets key`
2. Set it on all machines: `export LSH_SECRETS_KEY=<key>`
3. Re-push from source: `lsh secrets push`
