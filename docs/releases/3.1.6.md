# Release 3.1.6 - Continue Expanding Secrets Test Coverage

**Released:** December 1, 2025

## Summary

This release continues the comprehensive testing effort for secrets management (Issue #88), adding 29 more test cases and achieving 80% coverage for secrets-manager.ts.

## Changes

### New Test Cases

Added 29 new tests to `__tests__/secrets-manager.test.ts`:

**Show Method Formats (4 tests)**
- JSON format output
- YAML format output
- TOML format output
- Export format output

**Generate Export Commands Edge Cases (3 tests)**
- Handle non-existent file
- Handle quoted values (double and single)
- Skip malformed lines

**SmartSync Load Mode (2 tests)**
- Output exports in load mode after pull
- Handle in-sync state in load mode

**SmartSync Workspace Context (2 tests)**
- Show git repo context
- Show global workspace context in global mode

**SmartSync Scenarios (4 tests)**
- Pull action when cloud exists but not local
- Key mismatch without forceRekey
- Create and push when no local and no cloud
- Suggest commands when autoExecute is false

**Status Methods (4 tests)**
- Return cloud metadata when exists
- Suggest push when local exists but cloud does not
- Suggest pull when cloud exists but local does not
- Full cloud data with keyMatches

**Utility Methods (5 tests)**
- Resolve relative path in global mode
- Keep absolute path unchanged
- Get home directory
- IsGlobalMode returns true in global mode
- IsGlobalMode returns false when not in global mode

**Show Masking (2 tests)**
- Mask long values (show first 4 chars)
- Mask short values completely

**Other (3 tests)**
- List all environments
- Show error when no secrets found
- Cleanup without error

### Coverage Improvement

| Metric | v3.1.5 | v3.1.6 | Change |
|--------|--------|--------|--------|
| Statements | 74.65% | 80.15% | +5.50% |
| Branches | 68.54% | 74.48% | +5.94% |
| Functions | 97.29% | 97.29% | +0.00% |
| Lines | 74.45% | 80.00% | +5.55% |

### Cumulative Progress (Issue #88)

| Metric | Original | Current (v3.1.6) | Total Improvement |
|--------|----------|------------------|-------------------|
| Statements | 50.49% | 80.15% | +29.66% |
| Branches | 43.91% | 74.48% | +30.57% |
| Functions | 83.78% | 97.29% | +13.51% |
| Lines | 50.29% | 80.00% | +29.71% |

### Test Statistics

- Total tests: 1202 (29 new in this release)
- All tests pass
- No new dependencies

### Bug Fixes

- Fixed test using wrong constructor signature for global mode
- Fixed test expecting show() to log message instead of throw on missing secrets

## Remaining Coverage Gaps

The remaining ~20% uncovered code consists of:
- Error handling paths (file system errors, decryption failures)
- Complex conditional branches in smartSync method
- Edge cases requiring specific file system states
- IPFS storage exception handling

These paths would require extensive mocking to test properly and represent diminishing returns for additional test coverage.

## Diff Statistics

```
1 file changed, ~440 insertions(+), ~6 deletions(-)
```

## Related Issues

Part of Issue #88: Add comprehensive test suite for secrets management

## Full Changelog

https://github.com/gwicho38/lsh/compare/v3.1.5...v3.1.6
