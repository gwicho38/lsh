<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Job Detail - Pipeline Dashboard</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 24px;
      border-radius: 16px;
      margin-bottom: 24px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      color: #1a202c;
      font-size: 28px;
      margin-bottom: 8px;
    }

    .breadcrumb {
      color: #718096;
      font-size: 14px;
      margin-bottom: 16px;
    }

    .breadcrumb a {
      color: #667eea;
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .detail-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }

    @media (max-width: 1024px) {
      .detail-grid {
        grid-template-columns: 1fr;
      }
    }

    .detail-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
    }

    .detail-card h2 {
      color: #1a202c;
      font-size: 20px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-badge.running {
      background: #fef5e7;
      color: #f39c12;
    }

    .status-badge.completed {
      background: #e8f5e9;
      color: #27ae60;
    }

    .status-badge.failed {
      background: #ffebee;
      color: #e74c3c;
    }

    .status-badge.queued {
      background: #e3f2fd;
      color: #2196f3;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #e2e8f0;
    }

    .detail-row:last-child {
      border-bottom: none;
    }

    .detail-label {
      color: #718096;
      font-size: 14px;
      font-weight: 500;
    }

    .detail-value {
      color: #1a202c;
      font-size: 14px;
      font-weight: 600;
      text-align: right;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 8px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      border-radius: 4px;
      transition: width 0.3s ease;
    }

    .log-viewer {
      background: #1a202c;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.6;
      max-height: 500px;
      overflow-y: auto;
      position: relative;
    }

    .log-viewer.loading::after {
      content: '';
      position: absolute;
      bottom: 10px;
      right: 10px;
      width: 20px;
      height: 20px;
      border: 2px solid #667eea;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .log-line {
      margin: 2px 0;
      padding: 2px 4px;
      border-radius: 2px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .log-line.info {
      color: #64b5f6;
    }

    .log-line.success {
      color: #81c784;
    }

    .log-line.warning {
      color: #ffb74d;
      background: rgba(255, 183, 77, 0.1);
    }

    .log-line.error {
      color: #e57373;
      background: rgba(229, 115, 115, 0.1);
    }

    .log-line.timestamp {
      color: #9e9e9e;
      font-size: 11px;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .action-button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .action-button.primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .action-button.secondary {
      background: #e2e8f0;
      color: #1a202c;
    }

    .action-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .action-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .metric-card {
      background: #f7fafc;
      padding: 16px;
      border-radius: 8px;
      text-align: center;
    }

    .metric-value {
      font-size: 24px;
      font-weight: bold;
      color: #1a202c;
      margin-bottom: 4px;
    }

    .metric-label {
      font-size: 12px;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .execution-timeline {
      margin-top: 20px;
    }

    .timeline-item {
      display: flex;
      align-items: flex-start;
      margin-bottom: 20px;
      position: relative;
      padding-left: 40px;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: 15px;
      top: 24px;
      bottom: -20px;
      width: 2px;
      background: #e2e8f0;
    }

    .timeline-item:last-child::before {
      display: none;
    }

    .timeline-dot {
      position: absolute;
      left: 10px;
      top: 6px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #667eea;
      border: 2px solid white;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .timeline-content {
      flex: 1;
    }

    .timeline-time {
      font-size: 12px;
      color: #718096;
      margin-bottom: 4px;
    }

    .timeline-title {
      font-size: 14px;
      font-weight: 600;
      color: #1a202c;
      margin-bottom: 4px;
    }

    .timeline-description {
      font-size: 13px;
      color: #4a5568;
    }

    .tab-container {
      margin-top: 20px;
    }

    .tab-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      border-bottom: 2px solid #e2e8f0;
    }

    .tab-button {
      padding: 12px 24px;
      border: none;
      background: none;
      color: #718096;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .tab-button:hover {
      color: #1a202c;
    }

    .tab-button.active {
      color: #667eea;
    }

    .tab-button.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: #667eea;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 8px;
      background: white;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      border-left: 4px solid #48bb78;
    }

    .notification.error {
      border-left: 4px solid #f56565;
    }

    .notification.info {
      border-left: 4px solid #4299e1;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="breadcrumb">
      <a href="/dashboard/">Dashboard</a> / <a href="/dashboard/">Jobs</a> / <span id="job-name">Loading...</span>
    </div>

    <div class="header">
      <h1 id="job-title">Loading Job Details...</h1>
      <p>Real-time monitoring and execution details</p>
    </div>

    <div class="detail-grid">
      <!-- Main Details Section -->
      <div class="detail-card">
        <h2>
          Job Information
          <span id="job-status" class="status-badge">loading</span>
        </h2>

        <div class="tab-container">
          <div class="tab-buttons">
            <button class="tab-button active" onclick="switchTab('overview')">Overview</button>
            <button class="tab-button" onclick="switchTab('logs')">Logs</button>
            <button class="tab-button" onclick="switchTab('executions')">Executions</button>
            <button class="tab-button" onclick="switchTab('metrics')">Metrics</button>
          </div>

          <!-- Overview Tab -->
          <div id="overview-tab" class="tab-content active">
            <div class="detail-row">
              <span class="detail-label">Job ID</span>
              <span class="detail-value" id="job-id">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Type</span>
              <span class="detail-value" id="job-type">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Owner</span>
              <span class="detail-value" id="job-owner">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Source System</span>
              <span class="detail-value" id="job-source">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Target System</span>
              <span class="detail-value" id="job-target">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Schedule</span>
              <span class="detail-value" id="job-schedule">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Created</span>
              <span class="detail-value" id="job-created">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Last Updated</span>
              <span class="detail-value" id="job-updated">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Progress</span>
              <span class="detail-value" id="job-progress-text">0%</span>
            </div>
            <div class="progress-bar">
              <div id="job-progress-bar" class="progress-fill" style="width: 0%"></div>
            </div>
          </div>

          <!-- Logs Tab -->
          <div id="logs-tab" class="tab-content">
            <div class="action-buttons" style="margin-bottom: 16px;">
              <button class="action-button secondary" onclick="clearLogs()">Clear</button>
              <button class="action-button secondary" onclick="downloadLogs()">Download</button>
              <button id="auto-scroll-btn" class="action-button primary" onclick="toggleAutoScroll()">Auto-scroll: ON</button>
            </div>
            <div id="log-viewer" class="log-viewer">
              <div class="log-line timestamp">Waiting for logs...</div>
            </div>
          </div>

          <!-- Executions Tab -->
          <div id="executions-tab" class="tab-content">
            <div class="execution-timeline" id="execution-timeline">
              <!-- Timeline items will be added here -->
            </div>
          </div>

          <!-- Metrics Tab -->
          <div id="metrics-tab" class="tab-content">
            <div class="metrics-grid">
              <div class="metric-card">
                <div class="metric-value" id="metric-executions">0</div>
                <div class="metric-label">Total Executions</div>
              </div>
              <div class="metric-card">
                <div class="metric-value" id="metric-success">0</div>
                <div class="metric-label">Successful</div>
              </div>
              <div class="metric-card">
                <div class="metric-value" id="metric-failed">0</div>
                <div class="metric-label">Failed</div>
              </div>
              <div class="metric-card">
                <div class="metric-value" id="metric-avg-duration">0s</div>
                <div class="metric-label">Avg Duration</div>
              </div>
              <div class="metric-card">
                <div class="metric-value" id="metric-success-rate">0%</div>
                <div class="metric-label">Success Rate</div>
              </div>
              <div class="metric-card">
                <div class="metric-value" id="metric-last-run">-</div>
                <div class="metric-label">Last Run</div>
              </div>
            </div>
          </div>
        </div>

        <div class="action-buttons">
          <button class="action-button primary" onclick="executeJob()">Execute Now</button>
          <button class="action-button secondary" onclick="retryJob()">Retry</button>
          <button class="action-button secondary" onclick="cancelJob()">Cancel</button>
        </div>
      </div>

      <!-- Side Panel -->
      <div>
        <!-- Related Jobs -->
        <div class="detail-card" style="margin-bottom: 24px;">
          <h2>Related Jobs</h2>
          <div id="related-jobs" style="margin-top: 16px;">
            <!-- Related jobs will be populated here -->
          </div>
        </div>

        <!-- Quick Stats -->
        <div class="detail-card">
          <h2>Quick Stats</h2>
          <div class="metrics-grid" style="grid-template-columns: 1fr;">
            <div class="metric-card">
              <div class="metric-value" id="quick-status">-</div>
              <div class="metric-label">Current Status</div>
            </div>
            <div class="metric-card">
              <div class="metric-value" id="quick-runtime">-</div>
              <div class="metric-label">Runtime</div>
            </div>
            <div class="metric-card">
              <div class="metric-value" id="quick-next-run">-</div>
              <div class="metric-label">Next Run</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="notification" class="notification"></div>

  <script>
    const API_BASE = 'http://localhost:3034';
    const socket = io(API_BASE);

    let currentJob = null;
    let autoScroll = true;
    let logBuffer = [];

    // Get job ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const jobId = urlParams.get('id') || 'job-db-health-monitor';

    // Tab switching
    function switchTab(tabName) {
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

      document.querySelector(`.tab-button:nth-child(${['overview', 'logs', 'executions', 'metrics'].indexOf(tabName) + 1})`).classList.add('active');
      document.getElementById(`${tabName}-tab`).classList.add('active');

      if (tabName === 'logs') {
        loadLogs();
      } else if (tabName === 'executions') {
        loadExecutions();
      } else if (tabName === 'metrics') {
        loadMetrics();
      }
    }

    // Load job details
    async function loadJobDetails() {
      try {
        const response = await axios.get(`${API_BASE}/api/pipeline/jobs/${jobId}`);
        currentJob = response.data;

        // Update UI with job details
        document.getElementById('job-name').textContent = currentJob.name;
        document.getElementById('job-title').textContent = currentJob.name;
        document.getElementById('job-id').textContent = currentJob.id;
        document.getElementById('job-type').textContent = currentJob.type;
        document.getElementById('job-owner').textContent = currentJob.owner;
        document.getElementById('job-source').textContent = currentJob.sourceSystem;
        document.getElementById('job-target').textContent = currentJob.targetSystem;
        document.getElementById('job-schedule').textContent = currentJob.schedule || 'On-demand';
        document.getElementById('job-created').textContent = formatDate(currentJob.createdAt);
        document.getElementById('job-updated').textContent = formatDate(currentJob.updatedAt);

        // Update status
        const statusBadge = document.getElementById('job-status');
        statusBadge.textContent = currentJob.status;
        statusBadge.className = `status-badge ${currentJob.status}`;

        // Update progress
        const progress = currentJob.progress || 0;
        document.getElementById('job-progress-text').textContent = `${progress}%`;
        document.getElementById('job-progress-bar').style.width = `${progress}%`;

        // Update quick stats
        document.getElementById('quick-status').textContent = currentJob.status.toUpperCase();
        updateQuickStats();

        // Subscribe to job updates
        socket.emit('subscribe:job', jobId);

        // Load related jobs
        loadRelatedJobs();
      } catch (error) {
        console.error('Failed to load job details:', error);
        showNotification('Failed to load job details', 'error');
      }
    }

    // Load logs
    async function loadLogs() {
      const logViewer = document.getElementById('log-viewer');
      logViewer.classList.add('loading');

      try {
        // For demo, we'll read from the actual log file
        const response = await axios.get(`${API_BASE}/api/pipeline/jobs/${jobId}/logs`);
        const logs = response.data.logs || [];

        logViewer.innerHTML = '';
        logs.forEach(log => appendLog(log));

        if (logs.length === 0) {
          logViewer.innerHTML = '<div class="log-line timestamp">No logs available yet...</div>';
        }
      } catch (error) {
        // Simulate logs for demo
        const demoLogs = [
          { timestamp: new Date().toISOString(), level: 'info', message: 'Job started' },
          { timestamp: new Date().toISOString(), level: 'info', message: 'Connecting to database...' },
          { timestamp: new Date().toISOString(), level: 'success', message: 'Database connection established' },
          { timestamp: new Date().toISOString(), level: 'info', message: 'Running health checks...' },
          { timestamp: new Date().toISOString(), level: 'warning', message: 'High memory usage detected: 78%' },
          { timestamp: new Date().toISOString(), level: 'info', message: 'Health check completed' },
        ];

        logViewer.innerHTML = '';
        demoLogs.forEach(log => appendLog(log));
      } finally {
        logViewer.classList.remove('loading');
      }
    }

    // Append log entry
    function appendLog(log) {
      const logViewer = document.getElementById('log-viewer');
      const logLine = document.createElement('div');
      logLine.className = `log-line ${log.level || 'info'}`;

      const timestamp = log.timestamp ? `[${new Date(log.timestamp).toLocaleTimeString()}] ` : '';
      logLine.textContent = `${timestamp}${log.message}`;

      logViewer.appendChild(logLine);

      if (autoScroll) {
        logViewer.scrollTop = logViewer.scrollHeight;
      }
    }

    // Load executions
    async function loadExecutions() {
      const timeline = document.getElementById('execution-timeline');

      try {
        const response = await axios.get(`${API_BASE}/api/pipeline/jobs/${jobId}/executions`);
        const executions = response.data.executions || [];

        timeline.innerHTML = executions.map(exec => `
          <div class="timeline-item">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
              <div class="timeline-time">${formatDate(exec.startedAt)}</div>
              <div class="timeline-title">Execution #${exec.id}</div>
              <div class="timeline-description">
                Status: ${exec.status} | Duration: ${exec.duration || 'N/A'}
              </div>
            </div>
          </div>
        `).join('');
      } catch (error) {
        // Demo executions
        timeline.innerHTML = `
          <div class="timeline-item">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
              <div class="timeline-time">${formatDate(new Date())}</div>
              <div class="timeline-title">Current Execution</div>
              <div class="timeline-description">Status: Running | Duration: 2m 15s</div>
            </div>
          </div>
          <div class="timeline-item">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
              <div class="timeline-time">${formatDate(new Date(Date.now() - 3600000))}</div>
              <div class="timeline-title">Previous Execution</div>
              <div class="timeline-description">Status: Completed | Duration: 1m 45s</div>
            </div>
          </div>
        `;
      }
    }

    // Load metrics
    async function loadMetrics() {
      try {
        const response = await axios.get(`${API_BASE}/api/pipeline/jobs/${jobId}/metrics`);
        const metrics = response.data;

        document.getElementById('metric-executions').textContent = metrics.totalExecutions || '24';
        document.getElementById('metric-success').textContent = metrics.successfulExecutions || '22';
        document.getElementById('metric-failed').textContent = metrics.failedExecutions || '2';
        document.getElementById('metric-avg-duration').textContent = metrics.avgDuration || '45s';
        document.getElementById('metric-success-rate').textContent = metrics.successRate || '91.7%';
        document.getElementById('metric-last-run').textContent = formatTime(metrics.lastRun) || '5m ago';
      } catch (error) {
        // Use demo metrics
        document.getElementById('metric-executions').textContent = '24';
        document.getElementById('metric-success').textContent = '22';
        document.getElementById('metric-failed').textContent = '2';
        document.getElementById('metric-avg-duration').textContent = '45s';
        document.getElementById('metric-success-rate').textContent = '91.7%';
        document.getElementById('metric-last-run').textContent = '5m ago';
      }
    }

    // Load related jobs
    async function loadRelatedJobs() {
      const container = document.getElementById('related-jobs');

      try {
        const response = await axios.get(`${API_BASE}/api/pipeline/jobs?limit=3`);
        const jobs = response.data.jobs.filter(j => j.id !== jobId);

        container.innerHTML = jobs.slice(0, 3).map(job => `
          <div style="padding: 8px 0; border-bottom: 1px solid #e2e8f0;">
            <a href="?id=${job.id}" style="color: #667eea; text-decoration: none; font-size: 14px;">
              ${job.name}
            </a>
            <div style="font-size: 12px; color: #718096; margin-top: 4px;">
              ${job.status} • ${job.type}
            </div>
          </div>
        `).join('');
      } catch (error) {
        container.innerHTML = '<p style="color: #718096; font-size: 14px;">No related jobs found</p>';
      }
    }

    // Update quick stats
    function updateQuickStats() {
      if (!currentJob) return;

      // Calculate runtime if running
      if (currentJob.status === 'running' && currentJob.updatedAt) {
        const runtime = Date.now() - new Date(currentJob.updatedAt).getTime();
        document.getElementById('quick-runtime').textContent = formatDuration(runtime);
      } else {
        document.getElementById('quick-runtime').textContent = '-';
      }

      // Calculate next run based on schedule
      if (currentJob.schedule) {
        document.getElementById('quick-next-run').textContent = calculateNextRun(currentJob.schedule);
      } else {
        document.getElementById('quick-next-run').textContent = 'On-demand';
      }
    }

    // Action functions
    async function executeJob() {
      try {
        await axios.post(`${API_BASE}/api/pipeline/jobs/${jobId}/execute`);
        showNotification('Job execution started', 'success');
        loadJobDetails();
      } catch (error) {
        showNotification('Failed to execute job', 'error');
      }
    }

    async function retryJob() {
      try {
        await axios.put(`${API_BASE}/api/pipeline/jobs/${jobId}/retry`);
        showNotification('Job retry initiated', 'success');
        loadJobDetails();
      } catch (error) {
        showNotification('Failed to retry job', 'error');
      }
    }

    async function cancelJob() {
      if (!confirm('Are you sure you want to cancel this job?')) return;

      try {
        await axios.put(`${API_BASE}/api/pipeline/jobs/${jobId}/cancel`);
        showNotification('Job cancelled', 'info');
        loadJobDetails();
      } catch (error) {
        showNotification('Failed to cancel job', 'error');
      }
    }

    // Log functions
    function clearLogs() {
      document.getElementById('log-viewer').innerHTML = '<div class="log-line timestamp">Logs cleared</div>';
    }

    function downloadLogs() {
      const logs = document.getElementById('log-viewer').textContent;
      const blob = new Blob([logs], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${jobId}-logs-${Date.now()}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      showNotification('Logs downloaded', 'success');
    }

    function toggleAutoScroll() {
      autoScroll = !autoScroll;
      const btn = document.getElementById('auto-scroll-btn');
      btn.textContent = `Auto-scroll: ${autoScroll ? 'ON' : 'OFF'}`;
      btn.classList.toggle('primary', autoScroll);
      btn.classList.toggle('secondary', !autoScroll);
    }

    // Socket event handlers
    socket.on('job:update', (event) => {
      if (event.jobId === jobId) {
        loadJobDetails();
        if (document.getElementById('logs-tab').classList.contains('active')) {
          appendLog({
            timestamp: new Date().toISOString(),
            level: 'info',
            message: `Job status changed to ${event.status}`
          });
        }
      }
    });

    socket.on('job:log', (event) => {
      if (event.jobId === jobId && document.getElementById('logs-tab').classList.contains('active')) {
        appendLog(event.log);
      }
    });

    // Utility functions
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
    }

    function formatTime(dateStr) {
      const date = new Date(dateStr);
      const diff = Date.now() - date.getTime();

      if (diff < 60000) return 'Just now';
      if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
      if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
      return `${Math.floor(diff / 86400000)}d ago`;
    }

    function formatDuration(ms) {
      const seconds = Math.floor(ms / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);

      if (hours > 0) return `${hours}h ${minutes % 60}m`;
      if (minutes > 0) return `${minutes}m ${seconds % 60}s`;
      return `${seconds}s`;
    }

    function calculateNextRun(schedule) {
      // Simple cron schedule parser for demo
      if (schedule.includes('*/2')) return 'In 2 minutes';
      if (schedule.includes('*/5')) return 'In 5 minutes';
      if (schedule.includes('*/15')) return 'In 15 minutes';
      if (schedule.includes('*/30')) return 'In 30 minutes';
      if (schedule.includes('0 * *')) return 'Next hour';
      if (schedule.includes('0 9 *')) return 'Tomorrow 9:00 AM';
      return 'Scheduled';
    }

    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type} show`;

      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Initialize
    loadJobDetails();
    setInterval(updateQuickStats, 5000);
  </script>
</body>
</html>